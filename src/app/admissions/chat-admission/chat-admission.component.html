<div>
    <h2>Join Room</h2>
    <input [(ngModel)]="room" placeholder="Enter room name" />
    <button (click)="joinRoom(13)">Join Room</button>
</div>

<div *ngIf="room">
    <h2>Room: {{ room }}</h2>
    <div *ngFor="let msg of messages">
        <p>
            <span class="timestamp">{{ msg.timestamp }}</span>
            <strong>{{ msg.username }}:</strong> {{ msg.content }}
        </p>
    </div>
    <input [(ngModel)]="message" placeholder="Enter your message" />
    <button (click)="sendMessage()">Send</button>
</div>

<div class="chat-input">
    <input [(ngModel)]="message" (keydown.enter)="sendMessage()" placeholder="Type your message...">
    <button (click)="sendMessage()">Send</button>
    <input #fileInput type="file" (change)="previewImage($event)" style="display: none;" />
    <button (click)="fileInput.click()">Attach File</button>
    <button (click)="sendFile()">Send File</button>
    <img #preview [src]="previewSrc" *ngIf="previewSrc" alt="Image preview" style="max-width: 100%; max-height: 300px;" />
</div>









<!--start content-->

<div class="chat-wrapper">
    <div class="chat-sidebar">
        <div class="chat-sidebar-header">

            <div class="mb-3"></div>
            <div class="input-group input-group-sm"> <span class="input-group-text bg-transparent"><i class='bx bx-search'></i></span>
                <input type="text" class="form-control" placeholder="People, groups, & messages"> <span class="input-group-text bg-transparent"><i class='bx bx-dialpad'></i></span>
            </div>
            <div class="chat-tab-menu mt-3">
                <ul class="nav nav-pills nav-justified">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="pill" href="javascript:;">
                            <div class="font-24"><i class='bx bx-conversation'></i>
                            </div>
                            <div><small>Chats</small>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="pill" href="javascript:;">
                            <div class="font-24"><i class='bx bx-phone'></i>
                            </div>
                            <div><small>Calls</small>
                            </div>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="pill" href="javascript:;">
                            <div class="font-24"><i class='bx bx-bell'></i>
                            </div>
                            <div><small>Notifications</small>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="chat-sidebar-content">
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-Chats">
                    <div class="p-3">

                        <div class="dropdown mt-3"> <a href="#" class="text-uppercase text-secondary dropdown-toggle dropdown-toggle-nocaret" data-bs-toggle="dropdown">Recent Chats <i class='bx bxs-chevron-down'></i></a>
                            <div class="dropdown-menu"> <a class="dropdown-item" href="#">Recent Chats</a>

                                <a class="dropdown-item" href="#">Sort by Unread</a>
                            </div>
                        </div>
                    </div>
                    <div class="chat-list">
                        <div class="list-group list-group-flush">
                            <a *ngFor="let student of listStudent" type="button" (click)="joinRoom(student.Id)" class="list-group-item">
                                <div class="d-flex">
                                    <div class="chat-user-online">
                                        <img src="assets/images/avatars/avatar-2.png" width="42" height="42" class="rounded-circle" alt="" />
                                    </div>
                                    <div class="flex-grow-1 ms-2">
                                        <h4 class="mb-0 chat-title">{{student.FullName}}</h4>
                                        <p class="mb-0 chat-msg">You just got LITT up, Mike.</p>
                                    </div>
                                    <div class="chat-time">9:51 AM</div>
                                </div>
                            </a>
                            <a href="javascript:;" class="list-group-item active">
                                <div class="d-flex">
                                    <div class="chat-user-online">
                                        <img src="assets/images/avatars/avatar-3.png" width="42" height="42" class="rounded-circle" alt="" />
                                    </div>
                                    <div class="flex-grow-1 ms-2">
                                        <h4 class="mb-0 chat-title">Harvey Specter</h4>
                                        <p class="mb-0 chat-msg">Wrong. You take the gun....</p>
                                    </div>
                                    <div class="chat-time">4:32 PM</div>
                                </div>
                            </a>

                            <a href="javascript:;" class="list-group-item">
                                <div class="d-flex">
                                    <div class="chat-user-online">
                                        <img src="assets/images/avatars/avatar-11.png" width="42" height="42" class="rounded-circle" alt="" />
                                    </div>
                                    <div class="flex-grow-1 ms-2">
                                        <h4 class="mb-0 chat-title">Jonathan Sidwell</h4>
                                        <p class="mb-0 chat-msg">That's bullshit. This deal..</p>
                                    </div>
                                    <div class="chat-time">24/3/2020</div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="chat-header d-flex align-items-center">
        <div class="chat-toggle-btn"><i class='bx bx-menu-alt-left'></i>
        </div>
        <div>
            <a [routerLink]="['/admissions/formprofile']">
                <h2 class="mb-1 font-weight-bold">Username (role)</h2>
            </a>
            <div class="list-inline d-sm-flex mb-0 d-none"> <a href="javascript:;" class="list-inline-item d-flex align-items-center text-secondary"><small class='bx bxs-circle me-1 chart-online'></small>Active Now</a>
                <a href="javascript:;" class="list-inline-item d-flex align-items-center text-secondary">|</a>
                <a href="javascript:;" class="list-inline-item d-flex align-items-center text-secondary"><i class='bx bx-search me-1'></i>Find</a>
            </div>
        </div>
        <div class="chat-top-header-menu ms-auto">
            <a href="javascript:;"><i class='bx bx-phone'></i></a>
        </div>
    </div>
    <div class="chat-content">


        <div *ngFor="let msg of messages">
            <div class="chat-content-leftside" *ngIf="!checkUser(msg.username)">
                <div class=" d-flex">
                    <img src="assets/images/avatars/avatar-3.png" width="48" height="48" class="rounded-circle" alt="" />
                    <div class="flex-grow-1 ms-2">
                        <p class="mb-0 chat-time">Harvey, {{msg.timestamp | date:'dd/MM/yyyy HH:mm:ss'}}</p>
                        <p *ngIf="msg.content !== ''" class="chat-left-msg">{{msg.content}}</p>
                        <img *ngIf="isImage(msg.file)" class="chat-left-msg" width="100px" height="100px" [src]="'http://localhost:3000/uploads/chat/' + msg.file" alt="">
                        <a class="chat-left-msg" *ngIf="!isImage(msg.file)" [href]="'http://localhost:3000/download/' + msg.file"></a>
                    </div>
                </div>
            </div>
            <div class="usertext chat-content-rightside" *ngIf="checkUser(msg.username)">
                <div class="d-flex ms-auto">
                    <div class="flex-grow-1 me-2">
                        <p class="mb-0 chat-time text-end">you, {{msg.timestamp | date:'dd/MM/yyyy HH:mm:ss'}}</p>
                        <p *ngIf="msg.content !== ''" class="chat-right-msg">{{msg.content}}</p>
                        <img *ngIf="isImage(msg.file)" class="chat-right-msg" width="100px" height="100px" [src]="'http://localhost:3000/uploads/chat/' + msg.file" alt="">
                        <a class="chat-right-msg" *ngIf="!isImage(msg.file)" [href]="'http://localhost:3000/download/' + msg.file"></a>
                    </div>
                </div>
            </div>

        </div>






        <div id="chat">
            <!-- Your existing chat messages go here -->
        </div>

        <div>
            <ul class="chat-messages-show-list" id="message-list">

            </ul>

        </div>
        <!--
        <div class="chat-content-rightside">
            <div class="d-flex">
                <div class="flex-grow-1 me-2">
                    <p class="mb-0 chat-time text-end">you, 3:35 PM</p>
                    <p class="chat-right-msg">thanks Harvey</p>
                </div>
            </div>
        </div> -->

    </div>
    <form>
        <div class="chat-footer align-items-center">

            <div class="flex-grow-1 pe-2">

                <div class="input-group"> <span class="input-group-text"><i class='bx bx-smile'></i></span>
                    <textarea [(ngModel)]="message" name="inputchat" id="" cols="30" rows="1" class="form-control" placeholder="Type a message"></textarea>
                    <!-- <input type="text" class="form-control" placeholder="Type a message"> -->

                </div>
                <div class="chat-footer-menu">
                    <a (click)="sendMessage()"><i class='bx bx-send'></i></a>
                </div>
            </div>
            <!--<div class="chat-footer-menu">
                send
                <a href="javascript:;" (click)="SendMessage()"><i class='bx bx-send'></i></a>
                <a href="javascript:;"><i class='bx bx-paperclip'></i></a>

            </div> -->
            <div>

                <p-fileUpload name="demo[]" (onRemove)="onRemove($event)" (onClear)="onClear($event)" chooseLabel="Choose File" [showUploadButton]="false" (onSelect)="onSelect($event)" [multiple]="false" [maxFileSize]="5000000">
                    <ng-template pTemplate="content">
                        <ul *ngIf="uploadedFiles.length">
                            <li *ngFor="let file of uploadedFiles">{{ file.name }} - {{ file.size }} bytes</li>
                        </ul>
                    </ng-template>
                </p-fileUpload>
            </div>

        </div>
    </form>
    <!--start chat overlay-->
    <div class="overlay chat-toggle-btn-mobile"></div>
    <!--end chat overlay-->
</div>

<!--end page main-->

<script>
    import PerfectScrollbar from 'perfect-scrollbar';
    const reviewListScrollbar = new PerfectScrollbar(".review-list")
    const chatTalkScrollbar = new PerfectScrollbar(".chat-talk")
</script>